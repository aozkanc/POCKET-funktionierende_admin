{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container">

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <h2>üë• Projekt-Mitarbeiter-Zuordnung</h2>

    <!-- ‚ûï Ekle Butonu -->
    <button class="btn btn-primary mb-3" onclick="openZuordnungModal()">‚ûï Zuordnung hinzuf√ºgen</button>

    <form method="get" class="form-inline mb-3">
        <label for="projekt_filter" class="me-2">üîç Projekt filtern:</label>
        <select name="projekt_id" id="projekt_filter" class="form-control" onchange="this.form.submit()">
            <option value="">-- Alle Projekte --</option>
            {% for projekt in projekte %}
                <option value="{{ projekt.id }}" {% if projekt.id|stringformat:"s" == request.GET.projekt_id %}selected{% endif %}>
                    {{ projekt.projektname }}
                </option>
            {% endfor %}
        </select>
    </form>

    <table class="table">
        <thead>
            <tr>
                <th>Projekt</th>
                <th>Mitarbeiter</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for eintrag in zuordnungen %}
            <tr>
                <td>{{ eintrag.projekt.projektname }}</td>
                <td>{{ eintrag.mitarbeiter.vorname }} {{ eintrag.mitarbeiter.nachname }}</td>
                <td>
                    <a href="{% url 'admin_projektmitarbeiter_delete' eintrag.id %}" onclick="return confirm('‚ùóZuordnung wirklich l√∂schen?')">üóëÔ∏è L√∂schen</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ‚ûï Modal - Zuordnung hinzuf√ºgen -->
<div id="zuordnungModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeZuordnungModal()">&times;</span>
        <h2>Neue Zuordnung erstellen</h2>
        <form method="post" action="">
            {% csrf_token %}

            <label>Projekt:</label>
            <select name="projekt_id" class="form-control" required>
                <option value="">Bitte w√§hlen</option>
                {% for projekt in projekte %}
                <option value="{{ projekt.id }}">{{ projekt.projektname }}</option>
                {% endfor %}
            </select>

            <label>Mitarbeiter:</label>
            <select name="mitarbeiter_id" class="form-control" required>
                <option value="">Bitte w√§hlen</option>
                {% for mitarbeiter in mitarbeiter %}
                <option value="{{ mitarbeiter.id }}">{{ mitarbeiter.vorname }} {{ mitarbeiter.nachname }}</option>
                {% endfor %}
            </select>

            <br>
            <button type="submit" class="btn btn-success">Speichern</button>
        </form>
    </div>
</div>

<!-- JS dosyasƒ± -->
<script>
    function openZuordnungModal() {
        document.getElementById("zuordnungModal").style.display = "block";
    }
    function closeZuordnungModal() {
        document.getElementById("zuordnungModal").style.display = "none";
    }
    window.onclick = function(event) {
        const modal = document.getElementById("zuordnungModal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };

    // Modal kapat & form temizle i≈ülemi - sadece ba≈üarƒ± veya uyarƒ± mesajƒ± varsa
    document.addEventListener("DOMContentLoaded", function () {
        const messageBox = document.querySelector(".alert");
        if (messageBox) {
            // Modal'ƒ± kapat
            document.getElementById("zuordnungModal").style.display = "none";

            // Form alanlarƒ±nƒ± temizle
            const form = document.querySelector("#zuordnungModal form");
            if (form) form.reset();
        }
    });    
</script>
{% endblock %}